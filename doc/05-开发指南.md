# Luckee DAO 前端开发指南

## 概述

本文档为 Luckee DAO 前端开发团队提供详细的开发环境搭建、编码规范、测试策略和协作流程指南。

## 开发环境搭建

### 1. 系统要求

#### 最低要求
- **Node.js**: 18.0.0 或更高版本
- **npm**: 8.0.0 或更高版本
- **Git**: 2.30.0 或更高版本
- **操作系统**: Windows 10+, macOS 10.15+, Ubuntu 18.04+

#### 推荐配置
- **Node.js**: 20.0.0 LTS
- **npm**: 10.0.0
- **IDE**: Visual Studio Code
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+

### 2. 环境安装

#### 安装 Node.js
```bash
# 使用 nvm 安装 Node.js (推荐)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20.0.0
nvm use 20.0.0

# 或直接下载安装包
# https://nodejs.org/
```

#### 安装项目依赖
```bash
# 克隆项目
git clone https://github.com/LuckeeDAO/decentralized_decision_frontend.git
cd decentralized_decision_frontend

# 安装依赖
npm install

# 验证安装
npm run type-check
npm run lint
```

### 3. 开发工具配置

#### Visual Studio Code 配置
```json
// .vscode/settings.json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "emmet.includeLanguages": {
    "typescript": "html",
    "typescriptreact": "html"
  },
  "files.associations": {
    "*.css": "css"
  }
}
```

#### 推荐扩展
```json
// .vscode/extensions.json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-eslint",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-json"
  ]
}
```

## 项目结构

### 1. 目录结构
```
src/
├── components/          # 可复用组件
│   ├── common/         # 通用组件
│   │   ├── Button/     # 按钮组件
│   │   ├── Modal/      # 模态框组件
│   │   └── Loading/    # 加载组件
│   ├── forms/          # 表单组件
│   │   ├── FormField/  # 表单字段
│   │   └── Validation/ # 验证组件
│   ├── charts/         # 图表组件
│   │   ├── VotingChart/    # 投票图表
│   │   └── GovernanceChart/ # 治理图表
│   └── layout/         # 布局组件
│       ├── Header/     # 头部组件
│       ├── Sidebar/    # 侧边栏组件
│       └── Footer/     # 底部组件
├── pages/              # 页面组件
│   ├── VotingPage.tsx      # 投票页面
│   ├── GovernancePage.tsx  # 治理页面
│   ├── NFTPage.tsx         # NFT页面
│   └── SettingsPage.tsx    # 设置页面
├── hooks/              # 自定义 Hooks
│   ├── useAuth.ts          # 认证相关
│   ├── useApi.ts           # API 调用
│   ├── useLocalStorage.ts  # 本地存储
│   └── useDebounce.ts      # 防抖处理
├── store/              # 状态管理
│   ├── index.ts            # Store 配置
│   ├── slices/             # Redux Slices
│   │   ├── authSlice.ts    # 认证状态
│   │   ├── votingSlice.ts  # 投票状态
│   │   └── uiSlice.ts      # UI 状态
│   └── api/                # API 状态管理
│       └── apiSlice.ts     # API 状态
├── utils/              # 工具函数
│   ├── api.ts              # API 客户端
│   ├── constants.ts        # 常量定义
│   ├── formatters.ts       # 数据格式化
│   ├── validators.ts       # 验证函数
│   └── helpers.ts          # 辅助函数
├── types/              # TypeScript 类型定义
│   ├── api.ts              # API 类型
│   ├── auth.ts             # 认证类型
│   ├── voting.ts           # 投票类型
│   └── common.ts           # 通用类型
├── styles/             # 样式文件
│   ├── theme.ts            # Material-UI 主题
│   ├── globals.css         # 全局样式
│   └── components/         # 组件样式
├── test/               # 测试文件
│   ├── __mocks__/          # Mock 文件
│   ├── utils/              # 测试工具
│   └── setup.ts            # 测试配置
├── App.tsx             # 主应用组件
└── main.tsx            # 应用入口
```

### 2. 文件命名规范

#### 组件文件
```typescript
// 组件文件使用 PascalCase
// VotingPage.tsx
// UserProfile.tsx
// DataTable.tsx

// 组件目录结构
components/
├── UserProfile/
│   ├── index.tsx           # 主组件文件
│   ├── UserProfile.test.tsx # 测试文件
│   ├── UserProfile.stories.tsx # Storybook 文件
│   └── UserProfile.module.css # 样式文件
```

#### Hook 文件
```typescript
// Hook 文件使用 camelCase，以 use 开头
// useAuth.ts
// useApi.ts
// useLocalStorage.ts
```

#### 工具文件
```typescript
// 工具文件使用 camelCase
// apiClient.ts
// formatters.ts
// validators.ts
```

## 编码规范

### 1. TypeScript 规范

#### 类型定义
```typescript
// 接口定义使用 PascalCase
interface UserProfile {
  id: string;
  name: string;
  email: string;
  avatar?: string;
}

// 类型别名使用 PascalCase
type VoteOption = 'yes' | 'no' | 'abstain';

// 枚举使用 PascalCase
enum ProposalStatus {
  DRAFT = 'draft',
  ACTIVE = 'active',
  CLOSED = 'closed',
  EXECUTED = 'executed'
}

// 泛型使用单个大写字母
interface ApiResponse<T> {
  data: T;
  success: boolean;
  message?: string;
}
```

#### 函数定义
```typescript
// 函数使用 camelCase
const calculateVotingPower = (tokens: number, multiplier: number): number => {
  return tokens * multiplier;
};

// 异步函数
const fetchUserProfile = async (userId: string): Promise<UserProfile> => {
  const response = await apiClient.get(`/users/${userId}`);
  return response.data;
};

// 箭头函数
const formatCurrency = (amount: number): string => {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD'
  }).format(amount);
};
```

### 2. React 组件规范

#### 函数组件
```typescript
// 使用函数组件和 TypeScript
interface ButtonProps {
  children: React.ReactNode;
  variant?: 'primary' | 'secondary' | 'danger';
  size?: 'small' | 'medium' | 'large';
  disabled?: boolean;
  onClick?: () => void;
}

const Button: React.FC<ButtonProps> = ({
  children,
  variant = 'primary',
  size = 'medium',
  disabled = false,
  onClick
}) => {
  return (
    <button
      className={`btn btn-${variant} btn-${size}`}
      disabled={disabled}
      onClick={onClick}
    >
      {children}
    </button>
  );
};

export default Button;
```

#### Hooks 使用
```typescript
// 自定义 Hook
const useVotingData = (proposalId: string) => {
  const [votingData, setVotingData] = useState<VotingData | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchVotingData = async () => {
      setLoading(true);
      try {
        const data = await apiClient.get(`/voting/${proposalId}`);
        setVotingData(data.data);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'Unknown error');
      } finally {
        setLoading(false);
      }
    };

    fetchVotingData();
  }, [proposalId]);

  return { votingData, loading, error };
};
```

### 3. 样式规范

#### CSS-in-JS
```typescript
// 使用 Material-UI 的 styled 组件
import { styled } from '@mui/material/styles';
import { Box, Typography } from '@mui/material';

const StyledCard = styled(Box)(({ theme }) => ({
  padding: theme.spacing(2),
  borderRadius: theme.shape.borderRadius,
  backgroundColor: theme.palette.background.paper,
  boxShadow: theme.shadows[1],
  '&:hover': {
    boxShadow: theme.shadows[4],
  },
}));

const CardTitle = styled(Typography)(({ theme }) => ({
  fontSize: '1.25rem',
  fontWeight: 600,
  color: theme.palette.text.primary,
  marginBottom: theme.spacing(1),
}));
```

#### 全局样式
```css
/* globals.css */
:root {
  --primary-color: #1976d2;
  --secondary-color: #dc004e;
  --success-color: #2e7d32;
  --warning-color: #ed6c02;
  --error-color: #d32f2f;
  --text-primary: #212121;
  --text-secondary: #757575;
  --background-default: #fafafa;
  --background-paper: #ffffff;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Roboto', 'Helvetica', 'Arial', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* 滚动条样式 */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}
```

## 测试策略

### 1. 单元测试

#### 组件测试
```typescript
// Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import Button from './Button';

describe('Button Component', () => {
  it('renders with children', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByText('Click me')).toBeInTheDocument();
  });

  it('calls onClick when clicked', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>Click me</Button>);
    
    fireEvent.click(screen.getByText('Click me'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('is disabled when disabled prop is true', () => {
    render(<Button disabled>Click me</Button>);
    expect(screen.getByRole('button')).toBeDisabled();
  });
});
```

#### Hook 测试
```typescript
// useVotingData.test.ts
import { renderHook, waitFor } from '@testing-library/react';
import { useVotingData } from './useVotingData';

// Mock API client
jest.mock('../utils/api', () => ({
  apiClient: {
    get: jest.fn(),
  },
}));

describe('useVotingData Hook', () => {
  it('fetches voting data successfully', async () => {
    const mockData = { id: '1', title: 'Test Proposal' };
    (apiClient.get as jest.Mock).mockResolvedValue({ data: mockData });

    const { result } = renderHook(() => useVotingData('1'));

    await waitFor(() => {
      expect(result.current.votingData).toEqual(mockData);
      expect(result.current.loading).toBe(false);
      expect(result.current.error).toBeNull();
    });
  });

  it('handles fetch error', async () => {
    const mockError = new Error('Fetch failed');
    (apiClient.get as jest.Mock).mockRejectedValue(mockError);

    const { result } = renderHook(() => useVotingData('1'));

    await waitFor(() => {
      expect(result.current.votingData).toBeNull();
      expect(result.current.loading).toBe(false);
      expect(result.current.error).toBe('Fetch failed');
    });
  });
});
```

### 2. 集成测试

#### API 集成测试
```typescript
// api.test.ts
import { apiClient } from './api';

describe('API Client', () => {
  beforeEach(() => {
    // 重置 mock
    jest.clearAllMocks();
  });

  it('makes GET request with correct headers', async () => {
    const mockResponse = { data: { id: '1' } };
    global.fetch = jest.fn().mockResolvedValue({
      ok: true,
      json: () => Promise.resolve(mockResponse),
    });

    const result = await apiClient.get('/test');
    
    expect(global.fetch).toHaveBeenCalledWith(
      expect.stringContaining('/test'),
      expect.objectContaining({
        method: 'GET',
        headers: expect.objectContaining({
          'Content-Type': 'application/json',
        }),
      })
    );
    expect(result).toEqual(mockResponse);
  });
});
```

### 3. E2E 测试

#### 用户流程测试
```typescript
// voting.e2e.test.ts
import { test, expect } from '@playwright/test';

test.describe('Voting Flow', () => {
  test('user can vote on a proposal', async ({ page }) => {
    // 导航到投票页面
    await page.goto('/voting');
    
    // 等待页面加载
    await page.waitForSelector('[data-testid="proposal-list"]');
    
    // 点击第一个提案
    await page.click('[data-testid="proposal-item"]:first-child');
    
    // 选择投票选项
    await page.click('[data-testid="vote-option-yes"]');
    
    // 提交投票
    await page.click('[data-testid="submit-vote"]');
    
    // 验证成功消息
    await expect(page.locator('[data-testid="success-message"]')).toBeVisible();
  });
});
```

## 代码质量

### 1. ESLint 配置
```json
// .eslintrc.json
{
  "extends": [
    "eslint:recommended",
    "@typescript-eslint/recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended"
  ],
  "parser": "@typescript-eslint/parser",
  "plugins": ["@typescript-eslint", "react", "react-hooks"],
  "rules": {
    "react/react-in-jsx-scope": "off",
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn",
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  },
  "settings": {
    "react": {
      "version": "detect"
    }
  }
}
```

### 2. Prettier 配置
```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

### 3. Husky 配置
```json
// package.json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "npm run type-check && npm run test"
    }
  },
  "lint-staged": {
    "*.{ts,tsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

## 性能优化

### 1. 代码分割
```typescript
// 路由级别的代码分割
import { lazy, Suspense } from 'react';

const VotingPage = lazy(() => import('./pages/VotingPage'));
const GovernancePage = lazy(() => import('./pages/GovernancePage'));

// 使用 Suspense 包装
<Suspense fallback={<LoadingSpinner />}>
  <Routes>
    <Route path="/voting" element={<VotingPage />} />
    <Route path="/governance" element={<GovernancePage />} />
  </Routes>
</Suspense>
```

### 2. 内存优化
```typescript
// 使用 useMemo 优化计算
const expensiveValue = useMemo(() => {
  return heavyCalculation(data);
}, [data]);

// 使用 useCallback 优化函数
const handleClick = useCallback(() => {
  doSomething();
}, [dependency]);

// 清理副作用
useEffect(() => {
  const timer = setInterval(() => {
    updateData();
  }, 1000);

  return () => clearInterval(timer);
}, []);
```

### 3. 网络优化
```typescript
// 请求去重
const useApiCall = (url: string) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    let cancelled = false;

    const fetchData = async () => {
      setLoading(true);
      try {
        const result = await apiClient.get(url);
        if (!cancelled) {
          setData(result.data);
        }
      } catch (error) {
        if (!cancelled) {
          console.error('Fetch error:', error);
        }
      } finally {
        if (!cancelled) {
          setLoading(false);
        }
      }
    };

    fetchData();

    return () => {
      cancelled = true;
    };
  }, [url]);

  return { data, loading };
};
```

## 调试技巧

### 1. React DevTools
```typescript
// 使用 React DevTools 调试组件
const MyComponent = () => {
  const [state, setState] = useState(initialState);
  
  // 在 DevTools 中可以看到 state 的变化
  console.log('Component state:', state);
  
  return <div>{/* 组件内容 */}</div>;
};
```

### 2. Redux DevTools
```typescript
// 配置 Redux DevTools
const store = configureStore({
  reducer: rootReducer,
  devTools: process.env.NODE_ENV !== 'production',
});
```

### 3. 网络调试
```typescript
// 添加请求/响应拦截器进行调试
apiClient.interceptors.request.use(
  (config) => {
    console.log('Request:', config);
    return config;
  },
  (error) => {
    console.error('Request error:', error);
    return Promise.reject(error);
  }
);

apiClient.interceptors.response.use(
  (response) => {
    console.log('Response:', response);
    return response;
  },
  (error) => {
    console.error('Response error:', error);
    return Promise.reject(error);
  }
);
```

## 协作流程

### 1. Git 工作流
```bash
# 创建功能分支
git checkout -b feature/voting-enhancement

# 提交更改
git add .
git commit -m "feat: add voting enhancement feature"

# 推送到远程
git push origin feature/voting-enhancement

# 创建 Pull Request
# 在 GitHub 上创建 PR
```

### 2. 代码审查
- 所有代码必须经过至少一人审查
- 审查重点：功能正确性、代码质量、性能影响
- 使用 GitHub 的 PR 功能进行讨论

### 3. 发布流程
```bash
# 更新版本号
npm version patch  # 或 minor, major

# 构建和测试
npm run build
npm run test

# 部署
npm run deploy:pages

# 创建发布标签
git tag -a v1.0.1 -m "Release version 1.0.1"
git push origin v1.0.1
```

## 文档维护

### 1. 代码文档
```typescript
/**
 * 计算投票权重
 * @param tokens - 代币数量
 * @param multiplier - 权重乘数
 * @returns 计算后的投票权重
 * @example
 * ```typescript
 * const weight = calculateVotingPower(1000, 1.5);
 * console.log(weight); // 1500
 * ```
 */
const calculateVotingPower = (tokens: number, multiplier: number): number => {
  return tokens * multiplier;
};
```

### 2. README 更新
- 及时更新项目 README
- 记录新功能和变更
- 提供清晰的安装和使用说明

### 3. 变更日志
```markdown
# Changelog

## [1.0.1] - 2024-12-01

### Added
- 新增投票权重计算功能
- 添加用户偏好设置

### Changed
- 优化投票页面加载性能
- 更新 API 接口版本

### Fixed
- 修复投票提交失败的问题
- 修复移动端显示异常
```

---

*文档版本: 1.0.0*  
*最后更新: 2024年12月*  
*维护者: Luckee DAO 开发团队*
